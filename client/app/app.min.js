!function(){"use strict";angular.module("app",["ngMaterial","ngMessages","ngSanitize","ngFileSaver","ui.router","app.data","app.debounce","app.inflector","app.logger","app.plugins","app.templates","app.theme","app.auth","app.poll","app.result","app.myPolls","plugins.bar-chart","plugins.multiple-choice","plugins.word-cloud"])}(),function(){"use strict";angular.module("app.auth",[])}(),function(){"use strict";angular.module("app.myPolls",[])}(),function(){"use strict";angular.module("app.poll",[])}(),function(){"use strict";angular.module("app.result",[])}(),function(){"use strict";angular.module("app.data",[])}(),function(){"use strict";angular.module("app.debounce",[])}(),function(){"use strict";angular.module("app.inflector",[])}(),function(){"use strict";function e(e){e.decorator("$log",t)}function t(e,t){return{debug:t.debug,info:t.info,warn:t.warn,error:t.error,getInstance:t.getInstance}}angular.module("app.logger",[]).config(e),e.$inject=["$provide"],t.$inject=["$delegate","logger"]}(),function(){angular.module("app.plugins",["app.inflector"])}(),function(){"use strict";function e(e){e.theme("default").primaryPalette("blue").accentPalette("pink").backgroundPalette("grey",{"hue-1":"100"}),e.theme("secondary").backgroundPalette("blue").dark(),e.definePalette("searchPalette",e.extendPalette("grey",{contrastDefaultColor:"light",contrastDarkColors:["50"],50:"ffffff"})),e.theme("search").primaryPalette("searchPalette",{"default":"400","hue-1":"50"})}angular.module("app.theme",[]).config(e),e.$inject=["$mdThemingProvider"]}(),function(){"use strict";function e(e,t,o){o.otherwise("/"),e.disableAutoScrolling(),t.debugEnabled(!1)}angular.module("app").config(e),e.$inject=["$anchorScrollProvider","$logProvider","$urlRouterProvider"]}(),function(){"use strict";function e(e,t,o){function n(e,n){t.previousState&&t.previousState.name||o.go(e,n),o.go(t.previousState,t.previousStateParams)}t.goToPreviousState=n,t.$on("$stateChangeSuccess",function(o,n,l,i,r){t.previousState=i,t.previousStateParams=r,e.debug(i.name+" -> "+n.name,l)})}angular.module("app").run(e),e.$inject=["$log","$rootScope","$state"]}(),function(){"use strict";function e(e,t,o){function n(){return null!==r?o.resolve(r):t.post("is-authenticated").then(function(e){return r=e.data,o.resolve(r)})["catch"](function(t){return 401===t.status?o.reject():void e.error("isAuthenticated failed: ",t)})}function l(n){return t.post("login",n).then(function(t){return r=t.data,e.info("Logged in: ",r.username),r})["catch"](function(t){return e.error("Login failed: ",t.status+" - "+t.data),o.reject({code:t.status,message:t.data})})}function i(e){if(e){if(null===r)throw new Error("Cannot update user, you are not logged in");angular.copy(e,r)}return r}e=e.getInstance("auth");var r=null;return{isAuthenticated:n,login:l,user:i}}angular.module("app.auth").factory("auth",e),e.$inject=["$log","$http","$q"]}(),function(){"use strict";function e(e){e.state("auth",{template:"<ui-view />"}).state("auth.entry",{url:"/",onEnter:["$state","auth",function(e,t){t.isAuthenticated().then(function(t){e.go("poller"===t.group?"myPolls":"poll")})["catch"](function(){e.go("auth.login")})}]}).state("auth.login",{onEnter:["$window",function(e){e.location.assign("./login")}]}).state("auth.loginForm",{url:"/login",onEnter:["$mdDialog","$state",function(e,t){e.show({templateUrl:"app/auth/login.html",controller:"LoginController as vm"})["finally"](function(){t.go("auth.entry")})}]}).state("auth.logout",{onEnter:["$window",function(e){e.location.assign("./logout")}]}).state("auth.forbidden",{onEnter:["$rootScope","$mdDialog",function(e,t){t.show(t.alert().title("Not Authorized").content("You do not have permission to access this.").ok("Ok"))["finally"](function(){e.goToPreviousState()})}]})}angular.module("app.auth").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,o){function n(){l.isLoggingIn=!0,o.login(l.user).then(function(){t.hide()})["catch"](function(t){e.error("Login failed: ",t),l.serverErrors={},l.serverErrors[t.code]=!0,l.isLoggingIn=!1})}e=e.getInstance("LoginController");var l=this;l.user={username:"",password:""},l.login=n,l.serverErrors=null}angular.module("app.auth").controller("LoginController",e),e.$inject=["$log","$mdDialog","auth"]}(),function(){"use strict";function e(e,t,o){t.$on("$stateChangeStart",function(e,t,n,l,i){"myPolls"===t.name&&(e.preventDefault(),o.go("myPolls.upcoming")),"help"===t.name&&(e.preventDefault(),o.go("myPolls.help.default"))})}angular.module("app.myPolls").run(e),e.$inject=["$log","$rootScope","$state"]}(),function(){"use strict";function e(e,t,o){function n(e){return o.request("poll activate",{_id:e._id})}function l(e){angular.isArray(e.groups)&&e.groups.forEach(function(t){t.owners=e.owners,angular.isArray(t.polls)&&t.polls.forEach(function(e){e.owners=t.owners})})}function i(t){return o.depopulate(t,"groups"),t._response="created",e.debug("collection = ",t),o.request("collection create",t).then(function(t){return t=G(t),e.debug("createdCollection = ",t),q.push(t),t})}function r(t){var n=t.pollCollection;return o.depopulate(t,["pollCollection","polls"]),t._response="created",e.debug("group = ",t),o.request("group create",t).then(function(t){return t.collection=n,t=A(t),e.debug("createdGroup = ",t),t.collection.groups.push(t),t})}function a(e){return o.request("result create",{_id:e._id})}function s(e){var t=e.group;return o.depopulate(e,["group","pollCollection"]),e._response="created",o.request("poll create",e).then(function(e){return t.polls.push(e),O(e,t),e})}function c(t,n){return n?o.request("collection delete",{_id:t._id}).then(function(){var o=_.findIndex(q,function(e){return e._id===t._id});q.splice(o,1),e.info("Deleted collection: "+t._id)}):(t.deleted=new Date,t.groups.forEach(function(e){e.deleted=t.deleted}),E(t,"deleted"))}function u(t,n){return n?o.request("group delete",{_id:t._id}).then(function(){t.collection.groups.splice(w(t),1),e.info("Deleted group: "+t._id)}):(t.deleted=new Date,T(t,"deleted"))}function d(t,n){return n?o.request("poll delete",{_id:t._id}).then(function(){t.group.polls.splice(y(t),1),e.info("Deleted poll: "+t._id)}):(t.deleted=new Date,I(t,"deleted"))}function m(e){return p().then(function(o){var n=_.find(o,function(t){return t._id===e});return n||t.reject("Collection not found: ",e),n})}function p(e){return U&&!e?t.resolve(q):j?j:(U=!1,j=o.request("collection list").then(function(e){return angular.copy(e.map(G),q),U=!0,j=null,q}))}function g(e,o){return m(e).then(function(e){var n=_.find(e.groups,function(e){return e._id===o});return n||t.reject("Group not found: ",o),n})}function h(){return p().then(function(e){return _.flatten(_.pluck(e,"groups"))})}function v(e){return o.request("poll last result",{_id:e._id})}function f(e){return o.request("result",{_id:e})}function b(e){return o.request("poll list results",{_id:e})}function w(e){return _.findIndex(e.collection.groups,function(t){return e._id===t._id})}function y(e){return _.findIndex(e.group.polls,function(t){return e._id===t._id})}function $(e){return angular.isDate(e.deleted)?(e.deleted=null,E(e,"deleted")):t.resolve()}function P(e){return angular.isDate(e.deleted)?(e.deleted=null,T(e,"deleted").then(function(){return $(e.collection)})):t.resolve()}function C(e){return angular.isDate(e.deleted)?(e.deleted=null,I(e,"deleted").then(function(){return P(e.group)})):t.resolve()}function x(e,t){return t?(t=t.toLowerCase(),_.filter(e,function(e){var o=(e.collection.name+" - "+e.name).toLowerCase();return o.indexOf(t)>-1||_.some(e.polls,function(e){return e.name&&e.name.toLowerCase().indexOf(t)>-1})})):e}function S(e,t){if(e&&!(e.length<3)){var n={phrase:e};return t&&(n.group=t),o.request("user search",n)}}function k(e,t){var o=w(e),n=w(t),l=e.collection;return e.collection.groups[o]=t,t.collection.groups[n]=e,e.collection=t.collection,t.collection=l,E(e.collection,"groups").then(function(){return e.collection._id!==t.collection._id?E(t.collection,"groups"):void 0})}function R(e,t){var o=y(e),n=y(t);e.group;return e.group.polls[o]=O(t,t.group),t.group.polls[n]=O(e,e.group),T(e.group,"polls").then(function(){return e.group._id!==t.group._id?T(t.group,"polls"):void 0})}function E(t,n,l){var i=o.clone(t,n);return o.depopulate(i,["groups","owners"]),l&&(i._response=l===!0?"updated":l),o.request("collection update",i).then(function(o){return e.info("Updated collection: "+t._id),o?(o.groups=t.groups,o=G(o),angular.copy(o,t),t):void 0})}function T(t,n,l){var i=o.clone(t,n);return o.depopulate(i,["owners","polls"]),_.isObject(i.collection)&&(i.pollCollection=t.collection._id,delete i.collection),l&&(i._response=l===!0?"updated":l),o.request("group update",i).then(function(o){return e.info("Updated group: "+t._id),o?(o=A(o),o.collection=t.collection,angular.copy(o,t),t):void 0})}function I(t,n,l){var i=o.clone(t,n);return o.depopulate(i,["group","owners","pollCollection"]),l&&(groupCopy._response=l===!0?"updated":l),o.request("poll update",i).then(function(o){return e.info("Updated poll: "+t._id),o?(o=O(o,t.group),angular.copy(o,t),t):void 0})}function G(e){return angular.isString(e.created)&&(e.created=new Date(e.created)),angular.isString(e.deleted)&&(e.deleted=new Date(e.deleted)),angular.isArray(e.groups)&&(e.groups=e.groups.map(function(t){return t.collection=e,A(t)})),e}function A(e){return angular.isString(e.upcoming)&&(e.upcoming=new Date(e.upcoming)),angular.isString(e.deleted)&&(e.deleted=new Date(e.deleted)),e.collection&&(e.owners=e.collection.owners),angular.isArray(e.polls)&&(e.polls=e.polls.map(function(t){return O(t,e)})),e}function O(e,t){return angular.isString(e.deleted)&&(e.deleted=new Date(e.deleted)),e.group=t,e.pollCollection=t.pollCollection,e.owners=t.owners,e}e=e.getInstance("myPollsService");var q=[],j=null,U=!1;return{activatePoll:n,cascadeOwners:l,createCollection:i,createGroup:r,createPoll:s,createResult:a,deleteCollection:c,deleteGroup:u,deletePoll:d,getCollection:m,getCollections:p,getGroup:g,getGroups:h,getLastResult:v,getResult:f,getResults:b,groupIndex:w,pollIndex:y,restoreCollection:$,restoreGroup:P,restorePoll:C,searchGroups:x,searchUsers:S,swapGroups:k,swapPolls:R,updateCollection:E,updateGroup:T,updatePoll:I}}angular.module("app.myPolls").factory("myPollsService",e),e.$inject=["$log","$q","marsService"]}(),function(){"use strict";function e(e){e.state("myPolls",{url:"/my-polls",templateUrl:"app/my-polls/shell/shell.html",controller:"ShellController as vm"}).state("myPolls.upcoming",{url:"/upcoming",templateUrl:"app/my-polls/upcoming/upcoming.html",controller:"UpcomingController as upcomingVm"}).state("myPolls.collections",{url:"/collection",template:'<ui-view class="max-width-960"/>'}).state("myPolls.collections.viewCollection",{url:"/:collectionId",templateUrl:"app/my-polls/collections/view-collection.html",controller:"ViewCollectionController as vm"}).state("myPolls.collections.viewCollection.editCollection",{params:{collection:{type:Object}},onEnter:["$rootScope","$stateParams","$mdDialog",function(e,t,o){o.show({templateUrl:"app/my-polls/collections/edit-collection.html",controller:"EditCollectionController as vm",locals:{collection:t.collection}})["finally"](function(){e.goToPreviousState()})}]}).state("myPolls.collections.viewCollection.addGroup",{params:{collection:{type:Object}},onEnter:["$rootScope","$stateParams","$mdDialog",function(e,t,o){o.show({templateUrl:"app/my-polls/collections/add-group.html",controller:"AddGroupController as vm",locals:{collection:t.collection}})["finally"](function(){e.goToPreviousState()})}]}).state("myPolls.collections.viewCollection.editGroup",{params:{group:{type:Object}},onEnter:["$rootScope","$stateParams","$mdDialog",function(e,t,o){o.show({templateUrl:"app/my-polls/collections/edit-group.html",controller:"EditGroupController as vm",locals:{group:t.group}})["finally"](function(){e.goToPreviousState()})}]}).state("myPolls.collections.viewCollection.exportResult",{params:{group:{type:Object}},onEnter:["$rootScope","$stateParams","$mdDialog",function(e,t,o){o.show({templateUrl:"app/my-polls/collections/export-result.html",controller:"ExportResultController as vm",locals:{group:t.group}})["finally"](function(){e.goToPreviousState()})}]}).state("myPolls.collections.editPolls",{url:"/:collectionId/:groupId/edit",templateUrl:"app/my-polls/collections/edit-polls.html",controller:"EditPollsController as vm"}).state("myPolls.collections.editPolls.addPoll",{params:{group:{type:Object}},onEnter:["$rootScope","$state","$stateParams","$mdDialog",function(e,t,o,n){n.show({templateUrl:"app/my-polls/collections/add-poll.html",controller:"AddPollController as vm",locals:{group:o.group}}).then(function(){t.go("myPolls.collections.editPolls",o)})["catch"](function(){e.goToPreviousState()})}]}).state("myPolls.trash",{url:"/trash",templateUrl:"app/my-polls/trash/trash.html",controller:"TrashController as vm"}).state("myPolls.help",{url:"/help",template:'<ui-view class="max-width-960" />'}).state("myPolls.help.default",{templateUrl:"app/my-polls/help/help.html",controller:"HelpController as vm"}).state("myPolls.help.gettingStarted",{url:"/getting-started",templateUrl:"app/my-polls/help/getting-started.html",controller:"GettingStartedController as vm"})}angular.module("app.myPolls").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a,s){function c(){i.isAuthenticated().then(function(e){return"poller"!==e.group||l.preview?(s.onActivePollsChanged(o,g),s.getActivePolls(),void(v.isPreview=l.preview)):n.go("myPolls")},function(e){return n.go("auth.login")})}function u(){v.isPreview=!1,n.go("myPolls")}function d(){n.go("auth.logout")}function m(){var e=s.nextActivePoll();h(e)}function p(e){t.show({templateUrl:"app/poll/poll.subscribe.html",controller:"PollSubscribeController as vm",targetEvent:e}).then(function(){s.getActivePolls()})}function g(t,o){var n=s.activePoll();e.debug("Active poll: ",n),h(n),v.multiplePollsActive=o>1}function h(e){null===e?n.go("poll.none"):(v.poll=e.poll,v.result=e,n.go("poll.view"))}e=e.getInstance("PollController");var v=this;v.closePreview=u,v.logout=d,v.isPreview=!1,v.multiplePollsActive=!1,v.nextPoll=m,v.showSubscribeDialog=p,c()}angular.module("app.poll").controller("PollController",e),e.$inject=["$log","$mdDialog","$scope","$state","$stateParams","auth","plugins","PLUGIN_ACTIONS","pollService"]}(),function(){"use strict";function e(e,t,o,n,l){function i(){return h?g[h]:null}function r(){return e.info("Getting active polls"),l.request("poll list active").then(function(e){return g={},e.length>0&&(e.forEach(function(e){g[e._id]=e}),h=e[0]._id),d(),o.resolve()},o.reject)}function a(){var e=Object.keys(g),t=e.indexOf(h),o=t+1;return o>=e.length&&(o=0),h=e[o],i()}function s(e,t){var o=e.$on("activePollsChanged",function(o,n){t(o,n),e.$$phase||e.$apply()});e.$on("$destroy",o)}function c(){var e=Object.keys(g),t=e.indexOf(h),o=t-1;return 0>=o&&(o=e.length-1),h=e[o],_activePoll()}function u(t){return l.request("collection subscribe",t).then(function(o){n.user(o),e.info("Subscribed to collection: ",t)})}function d(){e.debug("active = ",h),t.$broadcast("activePollsChanged",Object.keys(g).length)}function m(t,o){e.debug("result = ",o),g[o._id]=o,null===h&&(h=o._id),e.info("Poll activated: "+o._id),e.debug("activations: ",g),d()}function p(t,o){h===o._id&&(Object.keys(g).length>1?a():h=null),delete g[o._id],e.info("Result deactivated: ",o._id),e.debug("activations: ",g),d()}e=e.getInstance("pollService");var g={},h=null;return l.on("poll activate",m),l.on("result resume",m),l.on("result deactivate",p),{activePoll:i,getActivePolls:r,nextActivePoll:a,onActivePollsChanged:s,prevActivePoll:c,subscribe:u}}angular.module("app.poll").factory("pollService",e),e.$inject=["$log","$rootScope","$q","auth","marsService"]}(),function(){"use strict";function e(e){e.state("poll",{params:{preview:{type:Boolean,"default":!1}},templateUrl:"app/poll/poll.html",controller:"PollController as vm"}).state("poll.none",{templateUrl:"app/poll/poll.none.html"}).state("poll.view",{templateUrl:"app/poll/poll.view.html"})}angular.module("app.poll").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t,o){function n(){t.cancel()}function l(){i.action="Joining",o.subscribe(i.collectionToken).then(function(){i.action=null,t.hide()})["catch"](function(e){e.code&&(i.serverErrors[e.code]=!0),i.action=null})}e=e.getInstance("PollSubscribeController");var i=this;i.action=null,i.cancel=n,i.collectionToken="",i.serverErrors={},i.subscribe=l}angular.module("app.poll").controller("PollSubscribeController",e),e.$inject=["$log","$mdDialog","pollService"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a,s){function c(){y=n.closeState||t.previousState.name,$=n.closeStateParams||t.previousStateParams,e.debug("closeState = ",y),e.debug("closeStateParams = ",$),i.isAuthenticated().then(function(o){var i=n.resultId;s.subscribe(i).then(function(n){return e.debug("result = ",n),w.poll=n.poll,w.result=n,w.isOwner=_.contains(n.pollCollection.owners,o._id),s.onResultActivate(t,p),s.onResultDeactivate(t,g),s.getActivations(n.poll._id)}).then(function(e){w.pastResults=_.filter(e,function(e){return e._id!=w.result._id&&e.responsesCount>0})})["catch"](function(t){e.error(t),t.code&&404===t.code&&l.show(l.alert().title("Not Found").content("The result does not exist").ok("Go Back"))})})}function u(){e.debug("close"),y||(y="myPolls"),e.debug("closeState = ",y),e.debug("closeStateParams = ",$),o.go(y,$)}function d(){return s.createResult(w.poll._id).then(b)}function m(e){e.active&&s.deactivate(e._id).then(function(){e.active=!1})}function p(e,t){t._id===w.result._id&&(w.result.active=!0)}function g(e,t){t._id===w.result._id&&(w.result.active=!1)}function h(e){return"plugins/"+result.type+"/"+result.type+".result.edit.html"}function v(e){e.active||s.resume(e._id).then(function(t){e.activations=t.activations,e.active=!0})}function f(){w.result.active?m(w.result):v(w.result)}function b(e){o.go("result",{resultId:e._id,closeState:y,closeStateParams:$})}e=e.getInstance("ResultController");var w=this;w.close=u,w.createResult=d,w.isOwner=!1,w.poll=null,w.result=null,w.resultViewTemplate=h,w.resume=v,w.showClose=!1,w.toast=null,w.toggleActive=f,w.viewResult=b;var y=null,$=null;c(),t.$on("$destroy",function(){w.isOwner&&w.result.active&&s.deactivate(w.result._id)})}angular.module("app.result").controller("ResultController",e),e.$inject=["$log","$scope","$state","$stateParams","$mdDialog","auth","plugins","PLUGIN_ACTIONS","resultService"]}(),function(){"use strict";function e(e,t,o,n){function l(e){return n.request("result create",{_id:e})}function i(e){return n.request("result deactivate",{_id:e})}function r(e){return n.request("poll list activations",{_id:e})}function a(e,o){var n=t.$on("resultActivate",o);e.$on("$destroy",n)}function s(e,o){var n=t.$on("resultDeactivate",o);e.$on("$destroy",n)}function c(e,t){var o={_id:e};return t&&(o.from=t),n.request("result resume",o)}function u(e){return n.request("result viewer",{_id:e})}function d(e,o){t.$broadcast("resultActivate",o)}function m(e,o){t.$broadcast("resultDeactivate",o)}return e=e.getInstance("resultService"),n.on("poll activate",d),n.on("result resume",d),n.on("result deactivate",m),{createResult:l,deactivate:i,getActivations:r,onResultActivate:a,onResultDeactivate:s,resume:c,subscribe:u}}angular.module("app.result").factory("resultService",e),e.$inject=["$log","$rootScope","$q","marsService"]}(),function(){"use strict";function e(e){e.state("result",{params:{closeState:{type:Object},closeStateParams:{type:Object}},url:"/result/:resultId",templateUrl:"app/result/result.html",controller:"ResultController as vm"}).state("result.view",{params:{poll:{type:Object},result:{type:Object}},template:"<ui-view />",controller:["$stateParams","$scope",function(e,t){for(var o in e)t[o]=e[o]}]}).state("result.resume",{params:{targetEvent:{type:Object}},onEnter:["$log","$state","$stateParams","$mdDialog","resultService",function(e,t,o,n,l){var i=n.confirm().title("No Longer Active").content("The poll you are trying to view results for is no longer active. ").ok("Resume").cancel("Cancel");n.show(i).then(function(){l.resume(o.resultId).then(function(o){e.debug("activation = ",o),t.go("result",{activationId:o._id})},e.error)},function(){t.go("myPolls")})}]})}angular.module("app.result").config(e),e.$inject=["$stateProvider"]}(),function(){"use strict";function e(e,t){return e=e.getInstance("csvWriter"),function(){function e(e){return r+=i(e)+",",s}function o(t){return r="",t.forEach(function(t){e(t)}),l(),s}function n(){return new t(a,{type:"text/csv;charset=utf-8"})}function l(){return a.push(r+"\n"),r="",s}function i(e){return angular.isString(e)?'"'+e.replace('"','""')+'"':'"'+e+'"'}var r="",a=[],s={addField:e,addRow:o,blob:n,newRow:l,rows:a};return s}}angular.module("app.data").factory("csvWriter",e),e.$inject=["$log","Blob"]}(),function(){"use strict";function e(e,t,o){function n(e,o){return t.debug("keys = ",o),angular.isString(o)&&(o=[o]),angular.isArray(o)?(o=_.union(o,["_id"]),_.pick(e,o)):_.clone(e)}function l(e,t,o){o=o||"_id",angular.isString(t)&&(t=[t]),angular.isArray(t)&&t.forEach(function(t){angular.isObject(e[t])&&_.has(e[t],o)?e[t]=e[t][o]:angular.isArray(e[t])&&(e[t]=_.map(e[t],function(e){return _.has(e,o)?e[o]:e}))})}function i(e){return angular.isObject(e)&&_.has(e,"_id")?e._id:angular.isString(e)?e:null}function r(o,n){return c?(e.$on(o,n),void(c.hasListeners(o)||c.on(o,function(n){t.debug("Received: "+o+" [event]"),e.$apply(function(){e.$emit(o,n)})}))):void u.push({name:o,listener:n})}function a(n,l){var i=o.defer();return c||s(),c.once(n,function(o){t.debug("Received: "+n+" [response]",o),e.$apply(function(){o&&o.hasOwnProperty("error")?(t.error("Failed: "+o.error.code+" - "+o.error.message),i.reject(o.error)):i.resolve(o)})}),t.debug("Sent: "+n),c.emit(n,l),i.promise}function s(){try{c=io()}catch(e){t.error(e)}u.forEach(function(e){r(e.name,e.listener)}),u=[]}t=t.getInstance("marsService");var c=null,u=[];return{clone:n,depopulate:l,id:i,on:r,request:a}}angular.module("app.data").factory("marsService",e),e.$inject=["$rootScope","$log","$q"]}(),function(){"use strict";function e(e,t){return e=e.getInstance("debounce"),function(e,o){function n(){e.apply(i,l),i=l=null}var l,i,r;return function(){i=this,l=arguments,r&&t.cancel(r),r=t(n,o)}}}angular.module("app.debounce").factory("debounce",e),e.$inject=["$log","$timeout"]}(),function(){"use strict";function e(){function e(e){return e.toLowerCase().replace(/(^|_|-)([a-z])/gi,function(e,t,o){return o.toUpperCase()})}function t(e){return e.toLowerCase().replace(/(^|(_|-))([a-z])/gi,function(e,t,o,n){return(t?" ":"")+n.toUpperCase()})}function o(e){return e.replace(" ","-").toLowerCase()}function n(){var n={classify:e,humanize:t,hyphenate:o};return n}return{classify:e,humanize:t,hyphenate:o,$get:n}}angular.module("app.inflector").provider("inflector",e)}(),function(){"use strict";function e(e){function t(e){return{debug:o("debug",e),info:o("info",e),warn:o("warn",e),error:o("error",e)}}function o(t,o){var l=e.console||{},i=l[t]||l._log||noop;return function(){var e=[];return angular.forEach(arguments,function(t,l){e.push(n(t,o,0===l))}),i.apply(l,e)}}function n(e,t,o){if(e instanceof Error)return l(e);if(!angular.isString(e))return e;var n=o?t?"["+r()+"]  "+t+"  ":"["+r()+"]  ":"";return n+e}function l(e,t){return e.stack?e=e.message&&-1===e.stack.indexOf(e.message)?"Error: "+e.message+"\n"+e.stack:e.stack:e.sourceURL&&(e=e.message+"\n"+e.sourceURL+":"+e.line),e}function o(t,o){var l=e.console||{},i=l[t]||l._log||noop;return function(){var e=[];return angular.forEach(arguments,function(t,l){e.push(n(t,o,0===l))}),i.apply(l,e)}}function i(e,t){return("000"+e).slice(-t)}function r(){var e=new Date;return i(e.getHours(),2)+":"+i(e.getMinutes(),2)+":"+i(e.getSeconds(),2)+"."+i(e.getMilliseconds(),3)}return{debug:o("debug"),info:o("info"),warn:o("warn"),error:o("error"),getInstance:t}}angular.module("app.logger").service("logger",e),e.$inject=["$window"]}(),function(){"use strict";angular.module("app.plugins").constant("PLUGIN",{POLL_TYPE:"POLL_TYPE",RESULT_TYPE:"RESULT_TYPE",RESULT_EXPORTERS:"RESULT_EXPORTERS"}).constant("PLUGIN_ACTIONS",{POLL_VIEW:"POLL_VIEW",POLL_EDIT:"POLL_EDIT",RESULT_VIEW:"RESULT_VIEW"}).constant("PLUGIN_ACTIONS_MAP",{POLL_TYPE:["POLL_VIEW","POLL_EDIT"],RESULT_TYPE:["RESULT_VIEW"]}).constant("PLUGIN_VIEWS",{POLL_VIEW:"poll.view",POLL_EDIT:"poll.edit",RESULT_VIEW:"result.view"})}(),function(){"use strict";function e(e,t){function o(e,t,o){o.$observe("marsPluginView",function(t){e.$watch("marsPluginName",function(o){t&&o&&(e.marsPluginTemplatePath="plugins/"+o+"/"+o+"."+t+".html")})})}e=e.getInstance("marsPlugin");var n={link:o,restrict:"E",scope:{marsPluginName:"=",marsPluginView:"@",poll:"=",result:"="},template:'<ng-include src="marsPluginTemplatePath"></ng-include>'};return n}angular.module("app.plugins").directive("marsPlugin",e),e.$inject=["$log","$compile"]}(),function(){"use strict";function e(e,t,o){function n(){for(var e in o)u[e]=[]}function l(e,o,n){i(e);var l={name:o};return n&&(l.options=n),u[e].push(l),s.debug("Registered "+t.humanize(e)+": "+o),c}function i(e){if(!u.hasOwnProperty(e))throw new Error('Invalid plugin type "'+e+'"')}function r(e,t,o,n){function l(l,i){var r=t.defer();if(o[i])return t.resolve(o[i]);var a=function(){e.$apply(function(){r.resolve(window[i])})},s=n[0].createElement("script");s.type="text/javascript",s.async=!0,s.src=l,s.onreadystatechange=function(){"complete"==this.readyState&&a()},s.onload=a;var c=n[0].getElementsByTagName("body")[0];return c.appendChild(s),r.promise}function r(e){return i(e),u[e]}var a={loadScript:l,registered:r};return a}var a=angular.injector(["ng"]),s=a.get("$log"),c=this,u={};n();var d={register:l,$get:r};return d.$get.$inject=["$rootScope","$q","$window","$document"],d}angular.module("app.plugins").provider("plugins",e),e.$inject=["$stateProvider","inflectorProvider","PLUGIN"]}(),function(){"use strict";function e(e,t,o,n){function l(e,t,o){t.__beforeSave=o,e.$on("$destroy",function(){delete t.__beforeSave})}function i(e,t){var o={_id:n.id(e),response:t};return n.request("response",o)}function r(e,t){c(e),t?u():m()}function a(e,t,o){angular.isFunction(e["__"+t])&&e["__"+t].apply(null,o)}function s(){var e=null,t=null;for(t in d)break;return t&&(e=d[t],delete d[t]),e}function c(e){var t=n.id(e);d[t]=e}function u(){var e=s();if(e){e._isSaving=!0;var t=angular.copy(e);return n.depopulate(t,["group","pollCollection"]),a(e,"beforeSave",[t]),n.request("poll update",t).then(function(){return delete e._isNew,delete e._isSaving,u()})}}e=e.getInstance("pollPluginService");var d={},m=o(u,1e3);return{beforeSave:l,submitResponse:i,updatePoll:r}}angular.module("app.plugins").factory("pollPluginService",e),e.$inject=["$log","$q","debounce","marsService"]}(),function(){"use strict";function e(e,t,o){function n(e,t,o){var n=e.$on("response received "+t,function(e,t){o(t)});e.$on("$destroy",n)}function l(o,n){e.debug("response = ",n),e.debug('$broadcast to: "response received '+n._id+'"'),t.$broadcast("response received "+n._id,n)}return e=e.getInstance("resultPluginService"),o.on("response",l),{onResponseReceived:n}}angular.module("app.plugins").factory("resultPluginService",e),e.$inject=["$log","$rootScope","marsService"]}(),angular.module("app.templates",[]).run(["$templateCache",function(e){e.put("app/auth/login.html",'<md-dialog aria-label="MARS Login" ng-cloak><form name="loginForm"><md-toolbar><div class="md-toolbar-tools"><h2>MARS Login</h2></div></md-toolbar><md-dialog-content style="max-width:650px; min-width: 480px"><div class="md-dialog-content"><md-input-container class="md-block"><label>Username</label><md-icon class="material_icons">person</md-icon><input name="username" required md-autofocus ng-model="vm.user.username"><div ng-messages="loginForm.username.$error"><div ng-message="required">You must enter a username</div></div></md-input-container><md-input-container class="md-block"><label>Password</label><md-icon class="material_icons">vpn_key</md-icon><input name="password" type="password" required ng-model="vm.user.password"><div ng-messages="loginForm.password.$error"><div ng-message="required">You must enter a password</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><div ng-message="401">The username or password was incorrect.</div></div></md-input-container></div></md-dialog-content><md-dialog-actions layout="column" layout-align="center center"><md-button class="md-primary" type="submit" ng-disabled="loginForm.$invalid" ng-click="vm.login()">Login</md-button></md-dialog-actions></form></md-dialog>'),e.put("app/poll/poll.html",'<div flex layout="column"><md-toolbar class="md-whiteframe-1dp" ng-class="{ \'bg-blue-grey\': vm.isPreview }"><div class="md-toolbar-tools"><h2><span>Mars</span></h2><span flex></span><md-button class="md-icon-button" aria-label="Join Feed" ng-hide="vm.isPreview" ng-click="vm.showSubscribeDialog($event)"><md-tooltip>Join feed</md-tooltip><md-icon class="material-icons">add</md-icon></md-button><md-button class="md-icon-button" aria-label="Close preview" ng-show="vm.isPreview" ng-click="vm.closePreview()"><md-tooltip>Close preview</md-tooltip><md-icon class="material-icons">visibility_off</md-icon></md-button><md-menu md-position-mode="target-right target"><md-button class="md-icon-button" aria-label="Account" ng-click="$mdOpenMenu($event)"><md-icon class="material-icons">account_circle</md-icon></md-button><md-menu-content width="3"><!-- <md-menu-item ng-show="vm.isPreview">\r\n            <md-button ng-click="vm.closePreview()">\r\n              My Polls\r\n            </md-button>\r\n          </md-menu-item> --><!-- <md-menu-divider></md-menu-divider> --><md-menu-item><md-button ng-click="vm.logout()">Sign out</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar><!-- Polls go here --><md-content flex layout-padding class="md-hue-1"><div ui-view class="max-width-960"></div></md-content><!-- Button to change polls (if more than 1 exists) --><md-button class="md-fab md-fab-bottom-right" aria-label="Switch Questions" ng-show="vm.multiplePollsActive" ng-click="vm.nextPoll()"><md-icon class="material-icons">queue</md-icon></md-button></div>'),e.put("app/poll/poll.none.html",'<div layout-align="center center" layout-fill layout="column"><div class="background-message">There are no polls at the moment</div></div>'),e.put("app/poll/poll.subscribe.html",'<md-dialog aria-label="Join a question feed"><form name="subscribeForm"><md-dialog-content><div class="md-dialog-content"><h2 class="md-title">Join a feed</h2><md-input-container class="md-icon-float"><label>Enter Code</label><md-icon class="material-icons">lock</md-icon><input name="collectionToken" required md-autofocus ng-model="vm.collectionToken"><div ng-messages="subscribeForm.collectionToken.$errors" ng-show="vm.serverErrors"><div ng-message="required">This is required</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><div ng-message="404">The code was incorrect</div></div></md-input-container></div></md-dialog-content><md-dialog-actions><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.subscribe()" ng-disabled="subscribeForm.$invalid">Join</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/poll/poll.view.html",'<mars-plugin mars-plugin-name="vm.poll.type" mars-plugin-view="poll.view" poll="vm.poll" result="vm.result"></mars-plugin>'),e.put("app/result/result.html",'<div flex layout="column"><md-toolbar class="md-whiteframe-1dp"><div class="md-toolbar-tools"><h2><span>Mars</span></h2><span flex></span><md-button aria-label="Lock result" ng-click="vm.toggleActive()"><md-icon class="svg-icons">{{vm.result.active ? \'lock\' : \'lock_open\'}}</md-icon><md-tooltip>{{vm.result.active ? \'Lock poll\' : \'Unlock poll\'}}</md-tooltip></md-button><!-- \r\n      <md-button aria-label="New result"\r\n                 ng-click="vm.newResult">\r\n        New Result\r\n      </md-button> --><md-button aria-label="Reset poll" ng-click="vm.createResult()"><md-icon class="svg-icons">autorenew</md-icon><md-tooltip>Reset poll</md-tooltip></md-button><md-menu><md-button aria-label="Resume result" ng-click="$mdOpenMenu($event)" ng-hide="!vm.pastResults || vm.pastResults.length === 0">Past Results</md-button><md-menu-content width="10"><!-- <md-menu-item ng-show="!vm.result.active">\r\n            <md-button ng-click="vm.resume(vm.result)">\r\n              <md-icon class="material-icons">restore</md-icon>\r\n              This result\r\n            </md-button>\r\n          </md-menu-item>\r\n          <md-menu-divider ng-show="!vm.result.active && vm.pastResults.length"></md-menu-divider> --><md-menu-item ng-repeat="pastResult in vm.pastResults"><md-button ng-click="vm.viewResult(pastResult)">{{pastResult.start | date:\'EEEE, dd MMMM yyyy, hh:mma\'}} - {{ pastResult.responsesCount }} Responses</md-button></md-menu-item></md-menu-content></md-menu><md-button class="md-icon-button" aria-label="Close result" ng-show="vm.isOwner" ng-click="vm.close()"><md-icon class="material-icons">close</md-icon></md-button></div></md-toolbar><md-content flex layout-padding class="md-hue-1"><div class="max-width-960"><mars-plugin mars-plugin-name="vm.result.type" mars-plugin-view="result.view" poll="vm.poll" result="vm.result"></mars-plugin></div></md-content><md-toolbar style="background: rgba(0,0,0,0.54)" ng-show="vm.result.active"><div class="md-toolbar-tools"><span>To respond to this poll, join the feed: <span class="md-accent">{{vm.result.token}}</span></span></div></md-toolbar><md-toolbar class="md-warn" ng-show="vm.result && !vm.result.active"><div class="md-toolbar-tools"><span>The poll is locked, responses will not be accepted</span> <span flex></span></div></md-toolbar></div>'),
e.put("app/my-polls/collections/add-group.html",'<md-dialog aria-label="Add New Group" ng-cloak><form name="addGroupForm"><md-dialog-content style="max-width:650px; min-width: 480px; min-height:500px"><div class="md-dialog-content"><h2>Add New Group</h2><md-input-container class="md-block"><label>Name</label><input name="name" required md-autofocus ng-disabled="vm.action" ng-model="vm.group.name"><div ng-messages="addGroupForm.name.$error"><div ng-message="required">This is required.</div></div></md-input-container><h4>Color</h4><md-grid-list md-cols-sm="6" md-cols-md="6" md-cols-gt-md="6" md-row-height-gt-md="1:1" md-row-height="2:2" md-gutter="12px" md-gutter-gt-sm="8px"><md-grid-tile class="bg-{{color}}" ng-repeat="color in vm.colors" ng-class="{\'md-whiteframe-2dp\': vm.group.color === color}" ng-click="vm.action || (vm.group.color = color)"><md-grid-tile-footer ng-show="vm.group.color === color"><h3 style="margin: 0 4px; text-align: center">{{vm.inflector.humanize(color)}}</h3></md-grid-tile-footer></md-grid-tile></md-grid-list></div></md-dialog-content><md-dialog-actions><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button type="submit" ng-click="vm.save()" style="margin-right:20px">Save</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/collections/add-poll.html",'<md-dialog aria-label="Create poll" ng-cloak><form name="addPollForm"><md-dialog-content style="max-width: 650px; min-width: 480px"><div class="md-dialog-content"><h2>Create New Poll</h2><md-input-container class="md-block"><label>Type</label><md-select ng-model="vm.poll.type"><md-option ng-repeat="plugin in vm.pollTypes" ng-value="plugin.name">{{vm.inflector.humanize(plugin.name)}}</md-option></md-select><div ng-messages="addPollForm.collectionName.$error"><div ng-message="required">This is required</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><div ng-message="403">You do not have permission to modify this collection</div></div></md-input-container></div></md-dialog-content><md-dialog-actions><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.create()" ng-disabled="addPollForm.$invalid">Create</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/collections/edit-collection.html",'<md-dialog aria-label="Edit collection" class="edit-collection" ng-cloak><form name="editCollectionForm"><md-dialog-content style="max-width:650px; min-width: 480px"><div class="md-dialog-content"><h2>Edit Collection</h2><md-input-container class="md-block"><label>Name</label><input name="collectionName" required md-autofocus ng-model="vm.collection.name"><div ng-messages="editCollectionForm.collectionName.$error"><div ng-message="required">This is required</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><div ng-message="403">You do not have permission to modify this collection</div></div></md-input-container><h4>Owners</h4><md-list><md-list-item ng-repeat="owner in vm.collection.owners"><md-icon aria-label="Remove owner" ng-click="vm.removeOwner(owner)">person</md-icon><p>{{ owner.name.first }} {{ owner.name.last }} ({{ owner.username }})</p><md-icon aria-label="Remove owner" class="md-secondary" ng-click="vm.removeOwner(owner)" ng-hide="owner._id === vm.user._id">clear</md-icon></md-list-item></md-list><div class="icon-autocomplete" layout="row"><md-icon>add</md-icon><md-autocomplete flex required md-floating-label="Add owner" md-items="item in vm.searchUsers(vm.addOwnerText)" md-min-length="3" md-no-cache="true" md-search-text="vm.addOwnerText" md-selected-item="vm.addOwnerSelectedUser" md-selected-item-change="vm.addOwner(vm.addOwnerSelectedUser)"><md-item-template><span md-highlight-text="vm.addOwnerText">{{item.name.first}} {{item.name.last}} ({{item.username}})</span></md-item-template></md-autocomplete></div></div></md-dialog-content><md-dialog-actions layout="row" layout-align="end center"><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.save()" ng-disabled="editCollectionForm.$invalid">Save</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/collections/edit-group.html",'<md-dialog aria-label="Edit group" ng-cloak><form name="editGroupForm"><md-dialog-content style="max-width:650px; min-width: 480px; min-height:500px"><div class="md-dialog-content"><h2>Edit Group</h2><md-input-container class="md-block"><label>Name</label><input name="groupName" required md-autofocus ng-disabled="vm.action" ng-model="vm.group.name"><div ng-messages="editGroupForm.groupName.$error"><div ng-message="required">This is required</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><div ng-message="403">You do not have permission to modify this group</div></div></md-input-container><h4>Color</h4><md-grid-list md-cols-sm="6" md-cols-md="6" md-cols-gt-md="6" md-row-height-gt-md="1:1" md-row-height="2:2" md-gutter="12px" md-gutter-gt-sm="8px"><md-grid-tile class="bg-{{color}}" ng-repeat="color in vm.colors" ng-class="{\'md-whiteframe-2dp\': vm.group.color === color}" ng-click="vm.action || (vm.group.color = color)"><md-grid-tile-footer ng-show="vm.group.color === color"><h3 style="margin: 0 4px; text-align: center">{{vm.inflector.humanize(color)}}</h3></md-grid-tile-footer></md-grid-tile></md-grid-list></div></md-dialog-content><md-dialog-actions><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.save()" ng-disabled="editGroupForm.$invalid">Save</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/collections/edit-polls.html",'<div layout="column" layout-fill layout-align="center center" class="background-message" ng-show="vm.polls.length == 0"><div>There are no polls in this group</div><div>Try clicking the plus icon to add a new poll</div></div><div class="edit-poll" ng-repeat="poll in vm.polls" mars-scroll-to="poll-{{$index}}" mars-scroll-when="poll._isNew"><a id="poll-{{$index}}"></a><div class="tools" layout="row" layout-align="start center"><div class="md-title md-primary">Poll {{$index + 1}}: {{vm.inflector.humanize(poll.type)}}</div><span flex></span><mars-action-progress action="poll._action ? poll._action : (poll._isSaving ? \'Saving\' : null)" md-diameter="36px"></mars-action-progress><md-button class="md-icon-button" aria-label="Reorder: move up" ng-disabled="$first" ng-click="vm.reorderPoll($index, $index - 1)"><md-tooltip>Move up</md-tooltip><md-icon class="material-icons">arrow_upward</md-icon></md-button><md-button class="md-icon-button" aria-label="Reorder: move down" ng-disabled="$last" ng-click="vm.reorderPoll($index, $index + 1)"><md-tooltip>Move down</md-tooltip><md-icon class="material-icons">arrow_downward</md-icon></md-button><md-button class="md-icon-button" aria-label="Delete poll" ng-click="vm.deletePoll($index)" ng-disabled="poll._isSaving"><md-tooltip>Delete</md-tooltip><md-icon class="material-icons">delete</md-icon></md-button></div><!-- <div mars-focus-when="poll._isNew"> --><!-- \r\n      mars-focus-when isn\'t working with mars-plugin. For the time being\r\n      stick with ng-include\r\n    \r\n    <mars-plugin mars-plugin-name="poll.type"\r\n                 mars-plugin-view="poll.edit"\r\n                 poll="poll"></mars-plugin>\r\n    --><ng-include mars-focus-when="poll._isNew" src="vm.pollEditTemplate(poll)"></ng-include><!-- </div> --><md-divider ng-show="!$last"></md-divider></div><div layout="column" layout-align="center center"><md-button aria-label="New Group" style="color: rgba(0,0,0,0.54)" ng-click="vm.addPoll()"><md-icon class="material-icons">add</md-icon>New Poll</md-button></div>'),e.put("app/my-polls/collections/export-result.html",'<md-dialog aria-label="Create poll" ng-cloak><form name="exportResultForm"><md-dialog-content style="max-width: 650px; min-width: 480px"><div class="md-dialog-content"><h2>Export Result</h2><md-input-container class="md-block"><label>Poll</label><md-select required ng-change="vm.selectedPollChanged()" ng-model="vm.selectedPoll" ng-model-options="{trackBy: \'$value._id\'}"><md-option ng-repeat="poll in vm.polls" ng-value="poll">{{poll.name}}</md-option></md-select></md-input-container><md-input-container class="md-block"><label>Result</label><md-select required ng-change="vm.selectedResultChanged()" ng-disabled="!vm.results || vm.results.length === 0" ng-model="vm.selectedResult" ng-model-options="{trackBy: \'$value._id\'}"><md-option ng-repeat="result in vm.results" ng-value="result">{{result.lastActivation.start | date:vm.resultDateFormat}} - {{result.responsesCount}} Responses</md-option></md-select></md-input-container><md-input-container class="md-block"><label>Export Format</label><md-select required ng-change="vm.selectedExporterChanged()" ng-disabled="!vm.exporters || vm.exporters.length === 0" ng-model="vm.selectedExporter" ng-model-options="{trackBy: \'$value.name\'}"><md-option ng-repeat="exporter in vm.exporters" ng-value="exporter">{{exporter.name}} ({{exporter.extension}})</md-option></md-select></md-input-container></div></md-dialog-content><md-dialog-actions><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.export()" ng-disabled="exportResultForm.$invalid">Export</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/collections/view-collection.html",'<div layout="column" layout-fill layout-align="center center" class="background-message" ng-show="vm.groups.length == 0"><div>It\'s looking pretty empty in here</div><div>Try clicking the plus icon to add a group</div></div><div ng-repeat="group in vm.filteredGroups" mars-scroll-to="group-{{$index}}" mars-scroll-trigger="group._scrollTo"><a id="group-{{$index}}"></a><md-card><md-toolbar class="bg-{{group.color}}"><div class="md-toolbar-tools"><h2 class="md-title" md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ group.collection.name }} - {{ group.name }}</h2><span flex></span><md-button aria-label="Reorder: move up" class="md-icon-button" ng-disabled="$first" ng-hide="vm.shell.search.show" ng-click="vm.reorderGroup($index, $index - 1)"><md-tooltip>Move up</md-tooltip><md-icon md-menu-origin class="material-icons">arrow_upward</md-icon></md-button><md-button aria-label="Reorder: move down" class="md-icon-button" ng-disabled="$last" ng-hide="vm.shell.search.show" ng-click="vm.reorderGroup($index, $index + 1)"><md-tooltip>Move down</md-tooltip><md-icon md-menu-origin class="material-icons">arrow_downward</md-icon></md-button><md-button aria-label="{{ vm.isUpcoming(group) ? \'Mark as done\' : \'Mark as upcoming\' }}" class="md-icon-button" ng-click="vm.toggleUpcoming(group)"><md-tooltip>{{ vm.isUpcoming(group) ? \'Mark as done\' : \'Mark as upcoming\' }}</md-tooltip><md-icon md-menu-origin class="material-icons">{{ vm.isUpcoming(group) ? \'done\' : \'autorenew\' }}</md-icon></md-button><md-menu md-position-mode="target-right target"><!-- Trigger element is a md-button with an icon --><md-button aria-label="Open collection menu" class="md-icon-button" ng-click="$mdOpenMenu()"><md-icon md-menu-origin class="material-icons">more_vert</md-icon></md-button><md-menu-content width="4"><md-menu-item><md-button ng-click=""><md-icon md-menu-align-target class="material-icons">timeline</md-icon>Analytics (TODO)</md-button></md-menu-item><md-menu-item><md-button ng-click="vm.exportResults(group)"><md-icon md-menu-align-target class="material-icons">file_download</md-icon>Export Results</md-button></md-menu-item><!-- <md-menu-item><md-button ng-click="">Copy (TODO)</md-button></md-menu-item> --><md-divider><md-menu-item><md-button ng-click="vm.editGroup(group)"><md-icon md-menu-align-target class="material-icons">edit</md-icon>Edit Group</md-button></md-menu-item><md-menu-item><md-button ng-click="vm.deleteGroup(group)"><md-icon md-menu-align-target class="material-icons">delete</md-icon>Delete Group</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar><md-list><md-list-item ng-class="{ \'background-message\': !poll.name }" ng-click="vm.viewResult(poll)" ng-repeat="poll in shownPolls = (group.polls | filter:{deleted:\'!\'})"><p md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ poll.name || \'[Unamed poll]\' }}</p></md-list-item><md-list-item class="background-message" ng-show="shownPolls.length === 0"><p>There are no polls in this group</p></md-list-item></md-list><div class="md-actions" layout="row" layout-align="end center"><div ng-show="!group._id" layout="row" layout-align="end center"><div>Saving</div><div class="progress-wrapper"><md-progress-circular md-mode="indeterminate" md-diameter="20px"></md-progress-circular></div></div><md-button class="md-primary" ng-show="group._id" ng-click="vm.editPolls(group, shownPolls.length === 0)">{{shownPolls.length > 0 ? \'Edit Polls\' : \'Create Polls\'}}</md-button></div></md-card></div><div layout="column" layout-align="center center"><md-button aria-label="New Group" style="color: rgba(0,0,0,0.54)" ng-click="vm.addGroup()" ng-hide="vm.shell.search.show"><md-icon class="material-icons">add</md-icon>New Group</md-button></div>'),e.put("app/my-polls/help/getting-started.html",'<div class="getting-started"><h2>Getting Started</h2><p>MARS is an audience response system that allows you to run different types of polls. People in the audience respond to polls using their phones. You can view the results in real time to get immediate feedback, or later for more detailed analysis. Getting started is easy:</p><h3><span class="title-number">1.</span>Create a Collection</h3><img class="md-whiteframe-1dp" src="./assets/img/create-collection.gif"><h3><span class="title-number">2.</span>Create a Group</h3><img class="md-whiteframe-1dp" src="./assets/img/create-group.gif"><h3><span class="title-number">3.</span>Create a Poll</h3><img class="md-whiteframe-1dp" src="./assets/img/create-poll.gif"><h3>Ready to Go!</h3><p>That\'s all there is to it. Your poll is now ready to run. To learn more about what MARS can do, check out <a ui-sref="myPolls.help.default">Help and Support</a>.</p></div>'),e.put("app/my-polls/help/help.html",'<div class="max-width-960"><md-card><md-card-content><h2>Help and Support</h2><p>TODO...</p></md-card-content></md-card></div>'),e.put("app/my-polls/trash/trash.html",'<div ng-show="vm.groups.length == 0" class="background-message"><div>There is nothing in your trash</div></div><div ng-show="vm.filteredGroups.length > 0" class="max-width-960"><div ng-repeat="group in vm.filteredGroups"><md-card><md-toolbar class="bg-{{group.color}}"><div class="md-toolbar-tools"><h2 class="md-title" md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ group.collection.name }} - {{ group.name }}</h2><span flex></span><md-menu md-position-mode="target-right target"><!-- Trigger element is a md-button with an icon --><md-button ng-click="$mdOpenMenu()" class="md-icon-button" aria-label="Open collection menu"><md-icon md-menu-origin class="material-icons">more_vert</md-icon></md-button><md-menu-content width="4"><md-menu-item><md-button ng-click="vm.restoreAllGroupsInCollection(group.collection)"><md-icon class="material-icons">reply_all</md-icon>Restore All In Collection (TODO)</md-button></md-menu-item><md-menu-item><md-button ng-click="vm.deleteGroupPermanently(group)"><md-icon class="material-icons">clear</md-icon>Delete Permanently</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar><md-list><md-list-item ng-class="{ \'background-message\': !poll.name }" ng-repeat="poll in group.polls" ng-show="group.deleted || poll.deleted"><p md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ poll.name || \'[Unamed poll]\' }}</p><mars-action-progress action="poll._action"><!-- \r\n              .md-secondary causes the button to be created at the end \r\n              of the md-list-item. This means it is no longer wrapped by \r\n              mars-action-progress, and as such won\'t  be shown/hidden\r\n              properly. Adding !poll._action to ng-show is a work around \r\n              to get the correct behaviour.\r\n            --><md-button class="md-secondary" ng-click="vm.restorePoll(group, poll)" ng-show="poll.deleted && !poll._action">Restore Poll</md-button></mars-action-progress></md-list-item><md-list-item class="background-message" ng-show="group.polls.length === 0"><p>There are no polls in this group</p></md-list-item></md-list><div class="md-actions" layout="row" layout-align="end center" ng-show="group.deleted"><mars-action-progress action="group._action"><md-button class="md-primary" ng-click="vm.restoreGroup(group)">Restore Group</md-button></mars-action-progress></div></md-card></div></div>'),e.put("app/my-polls/shell/action-progress.directive.html",'<div ng-hide="action" ng-transclude></div><div class="action-progress" layout="{{orientation === \'vertical\' ? \'column\' : \'row\'}}" layout--align="center center" ng-show="action"><md-progress-circular md-diameter="{{mdDiameter || \'24px\'}}" md-mode="indeterminate"></md-progress-circular>{{action | uppercase}}</div>'),e.put("app/my-polls/shell/add-collection.html",'<md-dialog aria-label="Add Collection" ng-cloak><form name="addCollectionForm"><md-dialog-content style="max-width:650px; min-width: 480px"><div class="md-dialog-content"><h2>Create New Collection</h2><md-input-container class="md-block"><label>Name</label><input name="collectionName" required md-autofocus ng-model="vm.collection.name"><div ng-messages="addCollectionForm.collectionName.$error"><div ng-message="required">This is required</div></div><div ng-messages="vm.serverErrors" ng-show="vm.serverErrors"><!-- <div ng-message="404">The code was incorrect.</div> --></div></md-input-container></div></md-dialog-content><md-dialog-actions layout="row" layout-align="end center"><mars-action-progress action="vm.action"><md-button type="button" ng-click="vm.cancel()">Cancel</md-button><md-button style="margin-right:20px" type="submit" ng-click="vm.create()" ng-disabled="addCollectionForm.$invalid">Create</md-button></mars-action-progress></md-dialog-actions></form></md-dialog>'),e.put("app/my-polls/shell/shell.html",'<md-sidenav layout="column" class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia(\'gt-md\')" ng-include="\'app/my-polls/shell/side-nav.html\'"></md-sidenav><div flex layout="column"><md-toolbar class="md-whiteframe-1dp" ng-hide="vm.shell.search.show"><div class="md-toolbar-tools"><md-button aria-label="Settings" class="md-icon-button md-secondary" hide-gt-md ng-click="vm.openLeftMenu()"><md-icon class="material-icons">menu</md-icon></md-button><md-button aria-label="Go back" class="md-icon-button" ng-click="vm.goBack()" ng-show="vm.shell.back.state"><md-tooltip>Back</md-tooltip><md-icon class="material-icons">arrow_back</md-icon></md-button><h3>{{ vm.shell.title }}</h3><span flex></span><md-button aria-label="Search" class="md-icon-button" ng-click="vm.shell.showSearch()" ng-show="vm.shell.search.callback"><md-tooltip>Search</md-tooltip><md-icon class="material-icons">search</md-icon></md-button><md-button aria-label="Preview polls" class="md-icon-button" ng-click="vm.goToState(\'poll\', { preview: true })"><md-tooltip>Preview polls</md-tooltip><md-icon class="material-icons">visibility</md-icon></md-button><md-menu md-position-mode="target-right target"><md-button aria-label="Account" class="md-icon-button" ng-click="$mdOpenMenu($event)"><md-icon class="material-icons">account_circle</md-icon></md-button><md-menu-content width="3"><md-menu-item><md-button ng-click="vm.logout()">Sign out</md-button></md-menu-item></md-menu-content></md-menu><md-menu md-position-mode="target-right target"><!-- Trigger element is a md-button with an icon --><md-button aria-label="Open menu" class="md-icon-button" ng-show="vm.shell.menu.show" ng-click="$mdOpenMenu()"><md-icon md-menu-origin class="material-icons">more_vert</md-icon></md-button><md-menu-content width="4"><md-menu-item ng-repeat="item in vm.shell.menu.items"><md-button ng-click="item.callback()"><md-icon md-menu-align-target class="material-icons" ng-show="item.icon">{{item.icon}}</md-icon>{{item.label}}</md-button></md-menu-item></md-menu-content></md-menu></div></md-toolbar><md-toolbar class="md-hue-1 md-whiteframe-2dp" mars-focus-when="vm.shell.search.show" md-theme="search" ng-show="vm.shell.search.show"><div class="md-toolbar-tools"><md-button aria-label="Close search" class="md-icon-button" ng-click="vm.shell.hideSearch()"><md-icon class="material-icons">arrow_back</md-icon></md-button><md-input-container flex><label>&nbsp;</label><input placeholder="Search..." mars-autofocus ng-model="vm.shell.search.phrase" ng-change="vm.shell.searchPhraseChanged()"></md-input-container><md-button aria-label="Close search" class="md-icon-button" ng-click="vm.shell.hideSearch()"><md-icon class="material-icons">close</md-icon></md-button></div></md-toolbar><md-content flex layout="column" class="md-hue-1"><a id="top"></a><mars-action-progress action="vm.action" class="shell" orientation="vertical" md-diameter="50px"><div ui-view layout-fill layout="row"></div></mars-action-progress></md-content></div>'),e.put("app/my-polls/shell/side-nav.html",'<md-toolbar class="md-hue-2"><div class="md-toolbar-tools">Mars</div></md-toolbar><md-content><md-list><md-list-item ng-click="vm.goToState(\'myPolls.upcoming\')"><md-icon class="material-icons">insert_chart</md-icon><p>Upcoming Polls</p></md-list-item><md-divider></md-divider><md-subheader>Collections</md-subheader><md-list-item ng-repeat="collection in vm.collections | filter: { deleted: \'!\' }" ng-click="vm.goToState(\'myPolls.collections.viewCollection\', { collectionId: collection._id })"><md-icon class="material-icons">keyboard_arrow_right</md-icon><p>{{ collection.name }}</p></md-list-item><md-list-item ng-click="vm.addCollection()"><md-icon class="material-icons">add</md-icon><p>Add New</p></md-list-item><md-divider></md-divider><md-subheader>Management</md-subheader><md-list-item ng-click="vm.goToState(\'myPolls.trash\')"><md-icon class="material-icons">delete</md-icon><p>Trash</p></md-list-item><md-list-item ng-click="goToState(\'myPolls.settings\')"><md-icon class="material-icons">settings</md-icon><p>Settings</p></md-list-item><md-list-item ng-click="vm.openExternal(\'https://drive.google.com/a/monash.edu/file/d/0B3jrsLjSGHrINktCaDlxV29WUnc/view?usp=sharing\')"><md-icon class="material-icons">help</md-icon><p>User Guide</p></md-list-item><md-list-item ng-click="vm.openExternal(\'https://docs.google.com/a/monash.edu/forms/d/1Qg91GKcnJxiflAIHqekrHzyBRGmmHwktGRw1mYYFvWQ/viewform\')"><md-icon class="material-icons">bug_report</md-icon><p>Help us improve!</p></md-list-item></md-list></md-content>'),e.put("app/my-polls/upcoming/upcoming.html",'<div layout="column" layout-fill layout-align="center center" class="background-message" ng-show="upcomingVm.groups.length == 0"><div>You have no upcoming polls</div><div>Mark polls as upcoming by clicking the<md-icon class="material-icons">autorenew</md-icon>button</div></div><div ng-show="upcomingVm.groups.length > 0" class="max-width-960"><div ng-repeat="group in upcomingVm.filteredGroups"><md-card><md-toolbar class="bg-{{group.color}}"><div class="md-toolbar-tools"><h2 class="md-title" md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ group.collection.name }} - {{ group.name }}</h2><span flex></span><md-button class="md-icon-button md-secondary" aria-label="Finished Group" ng-click="upcomingVm.markGroupAsDone($index)"><md-icon class="material-icons">check</md-icon></md-button></div></md-toolbar><md-list><md-list-item ng-class="{ \'background-message\': !poll.name }" ng-click="upcomingVm.viewResult(poll)" ng-repeat="poll in shownPolls = (group.polls | filter:{deleted:\'!\'})"><p md-highlight-flags="i" md-highlight-text="vm.shell.search.phrase">{{ poll.name || \'[Unamed poll]\' }}</p></md-list-item><md-list-item class="background-message" ng-show="shownPolls.length === 0"><p>There are no polls in this group</p></md-list-item></md-list></md-card></div></div>'),e.put("app/multiple-choice/multiple-choice.poll.edit.html",'<form name="editPollForm" ng-controller="MultipleChoicePollEditController as vm"><md-card><md-card-content layout="row" layout-align="start center"><md-input-container style="font-size: larger" flex><label>Question</label><textarea name="question" required mars-autofocus ng-model="poll.data.question" ng-change="vm.questionChanged(poll)">\r\n        </textarea><div ng-messages="editPollForm.question.$error"><div ng-message="required">This is required</div></div></md-input-container></md-card-content></md-card><md-whiteframe class="md-whiteframe-2dp mc-choice" layout="row" layout-align="start center" ng-class="{ blank: choice.blank }" ng-repeat="choice in poll.data.choices track by $index"><h2>{{choice.label}}</h2><md-input-container flex><label>{{ choice.blank ? \'Start typing to create choice\' : \'Text\' }}</label><input ng-model="choice.text" ng-change="vm.choiceValueChanged($index, choice)"></md-input-container><md-checkbox aria-label="Correct choice" flex="initial" ng-change="vm.choiceValueChanged($index, choice)" ng-model="choice.correct" ng-show="!choice.blank"><md-tooltip>Correct</md-tooltip></md-checkbox><md-button aria-label="Delete Choice" class="md-icon-button" tabindex="-1" ng-click="vm.removeChoice($index)" ng-show="!choice.blank"><md-icon class="material-icons">close</md-icon><md-tooltip>Delete choice</md-tooltip></md-button></md-whiteframe></form>'),e.put("app/multiple-choice/multiple-choice.poll.view.html",'<div ng-controller="MultipleChoicePollViewController as vm"><md-card><md-card-content><h2 class="md-title text-select-disabled">{{ poll.data.question }}</h2></md-card-content></md-card><md-whiteframe layout="row" layout-align="start center" class="md-whiteframe-2dp mc-choice text-select-disabled" md-ink-ripple="#2196F3" ng-repeat="choice in poll.data.choices" ng-class="{\'bg-selected\': choice == vm.selectedChoice}" ng-click="vm.submitResponse(choice)"><h2>{{ choice.label }}</h2><span flex>{{ choice.text }}</span></md-whiteframe></div>'),e.put("app/multiple-choice/multiple-choice.result.view.html",'<div ng-controller="MultipleChoiceResultViewController as vm"><md-card><md-card-content><h2 class="md-title">{{ poll.data.question }}</h2></md-card-content></md-card><md-card><md-card-content><bar-chart data="result.data[\'multiple-choice\']" bar-height="52px" bar-padding="8px" font-size="24px" label-margin="48px"></bar-chart></md-card-content></md-card></div>'),e.put("app/word-cloud/word-cloud.poll.edit.html",'<form name="editPollForm" ng-controller="WordCloudPollEditController as vm"><md-card><md-card-content layout="row" layout-align="start center"><md-input-container style="font-size: larger" flex><label>Question</label><textarea name="question" required mars-autofocus ng-model="poll.data.question" ng-change="vm.questionChanged(poll)">\r\n        </textarea><div ng-messages="editPollForm.question.$error"><div ng-message="required">This is required</div></div></md-input-container></md-card-content></md-card></form>'),e.put("app/word-cloud/word-cloud.poll.view.html",'<form name="responseForm" ng-controller="WordCloudPollViewController as vm"><md-card><md-card-content><h2 class="md-title text-select-disabled">{{ poll.data.question }}</h2></md-card-content></md-card><md-whiteframe class="md-whiteframe-2dp wc-response" layout="row" layout-align="start center" mars-focus-when="!vm.hasSubmitted"><md-input-container flex><label>Answer</label><input name="response" required mars-autofocus ng-disabled="vm.hasSubmitted" ng-model="vm.response"><div ng-messages="responseForm.response.$error"><div ng-message="required">This is required</div></div></md-input-container><md-button aria-label="Submit response" class="md-icon-button" type="submit" ng-click="vm.submitResponse(vm.response)" ng-disabled="responseForm.$invalid" ng-hide="vm.hasSubmitted"><md-icon class="material-icons">done</md-icon><md-tooltip>Submit response</md-tooltip></md-button><md-button aria-label="Clear response" class="md-icon-button" ng-click="vm.clearResponse()" ng-disabled="!vm.hasSubmitted" ng-show="vm.hasSubmitted"><md-icon class="material-icons">close</md-icon><md-tooltip>Clear response</md-tooltip></md-button></md-whiteframe></form>'),e.put("app/word-cloud/word-cloud.result.view.html",'<div ng-controller="WordCloudResultViewController as vm"><md-card><md-card-content><h2 class="md-title">{{ poll.data.question }}</h2></md-card-content></md-card><md-card><md-card-content><word-cloud words="result.data[\'word-cloud\']"></word-cloud></md-card-content></md-card></div>')}]),function(){"use strict";function e(e,t,o,n,l,i){function r(){s.action="Saving",l.createGroup(s.group).then(function(e){s.action=null,e._scrollTo=!0,t.hide()})}function a(){t.cancel()}e=e.getInstance("AddGroupController");var s=this;s.action=null,s.cancel=a,s.colors=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","lime-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey"],s.group={name:"",pollCollection:i,color:i.groups.length>0?_.last(i.groups).color:_.first(s.colors),polls:[],upcoming:new Date},s.inflector=o,s.isSaving=!1,s.save=r}angular.module("app.myPolls").controller("AddGroupController",e),e.$inject=["$log","$mdDialog","inflector","plugins","myPollsService","collection"]}(),function(){"use strict";function e(e,t,o,n,l,i,r){e=e.getInstance("AddPollController");var a=this;a.action=null,a.group=r,a.inflector=o,a.pollTypes=n.registered(l.POLL_TYPE),a.poll={name:"New Poll",group:r,pollCollection:r.pollCollection,type:a.pollTypes[0].name,data:{}},a.serverErrors={},a.create=function(){a.action="Saving",i.createPoll(a.poll).then(function(e){a.action=null,t.hide("create")})["catch"](function(e){a.serverErrors[e.code]=!0,a.action=null})},a.cancel=function(){t.cancel()}}angular.module("app.myPolls").controller("AddPollController",e),e.$inject=["$log","$mdDialog","inflector","plugins","PLUGIN","myPollsService","group"]}(),function(){"use strict";function e(e,t,o,n,l){function i(e){if(e){var t=_.sortedIndex(u.collection.owners,e,function(e){return e.name.first+e.name.last});u.collection.owners.splice(t,0,e),u.addOwnerSelectedUser=null,u.addOwnerText=null}}function r(e){u.collection.owners.splice(u.collection.owners.indexOf(e),1)}function a(e){return n.searchUsers(e,"poller").then(function(e){var t=_.pluck(u.collection.owners,"_id");return _.filter(e,function(e){return!_.contains(t,e._id)})})["catch"](function(e){return e.code&&404===e.code?[]:void 0})}function s(){u.action="Saving",n.updateCollection(u.collection).then(function(){l.name=u.collection.name,l.owners=u.collection.owners,n.cascadeOwners(l),u.action=null,t.hide(l)})["catch"](function(e){u.serverErrors[e.code]=!0,u.action=null})}function c(){t.cancel()}e=e.getInstance("EditCollectionController");var u=this;u.action=null,u.addOwner=i,u.addOwnerSelectedUser=null,u.addOwnerText=null,u.cancel=c,u.collection={_id:l._id,name:l.name,owners:_.sortBy(l.owners,function(e){return e.name.first+e.name.last})},u.removeOwner=r,u.save=s,u.searchUsers=a,u.serverErrors={},u.user=o.user()}angular.module("app.myPolls").controller("EditCollectionController",e),e.$inject=["$log","$mdDialog","auth","myPollsService","collection"]}(),function(){"use strict";function e(e,t,o,n,l,i){function r(){s.action="Saving",
l.updateGroup(s.group).then(function(){i.name=s.group.name,i.color=s.group.color,s.action=null,t.hide(i)})["catch"](function(e){s.serverErrors[e.code]=!0,s.action=null})}function a(){t.cancel()}e=e.getInstance("EditGroupController");var s=this;s.action=null,s.cancel=a,s.colors=["red","pink","purple","deep-purple","indigo","blue","light-blue","cyan","teal","green","lime-green","lime","yellow","amber","orange","deep-orange","brown","blue-grey"],s.group={_id:i._id,name:i.name,color:i.color},s.inflector=o,s.save=r,s.serverErrors={}}angular.module("app.myPolls").controller("EditGroupController",e),e.$inject=["$log","$mdDialog","inflector","plugins","myPollsService","group"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a,s){function c(){n.$on("$stateChangeSuccess",function(e,t,o,n,l){"myPolls.collections.editPolls"===t.name&&h.group&&g(h.group)}),s.getGroup(i.collectionId,i.groupId).then(g),t("top")}function u(){l.go("myPolls.collections.editPolls.addPoll",{group:h.group})}function d(e){var t=h.polls[e];o.show(o.confirm().title("Delete Poll").content("Are you sure you would like to delete Poll "+(e+1)+"?").ok("Yes").cancel("No")).then(function(){h.polls.splice(e,1),s.deletePoll(t,t._isNew)})}function m(e){return"plugins/"+e.type+"/"+e.type+".poll.edit.html"}function p(e,o){if(!(0>o||o>=h.polls.length)){var n=h.polls[e],l=h.polls[o];s.swapPolls(n,l),h.polls[e]=l,h.polls[o]=n,t("poll-"+o)}}function g(e){h.group=e,h.polls=_.filter(e.polls,function(e){return!angular.isDate(e.deleted)}),a.setTitle(n,e.collection.name+" - "+e.name),a.setBack(n,"myPolls.collections.viewCollection",{collectionId:e.collection._id}),h.activating=!1}e=e.getInstance("EditPollsController");var h=this;h.activating=!1,h.addPoll=u,h.deletePoll=d,h.group=null,h.inflector=r,h.isSaving=!1,h.pollEditTemplate=m,h.reorderPoll=p,c()}angular.module("app.myPolls").controller("EditPollsController",e),e.$inject=["$log","$anchorScroll","$mdDialog","$scope","$state","$stateParams","inflector","shell","myPollsService"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a,s,c){function u(){n.cancel()}function d(){h.action="Preparing";var i=o.get(h.selectedExporter.factory);s.getResult(h.selectedResult._id).then(i).then(function(o){h.action="Downloading";var i="MARS Result "+t("date")(h.selectedResult.lastActivation.start,"yyyy-MM-dd HH.mm")+" "+h.selectedExporter.name+h.selectedExporter.extension;l.saveAs(o,i),e.info("Exported result "+h.selectedResult._id+' to file "'+i+'"'),h.action=null,n.hide()})}function m(){e.debug("Selected exporter: ",h.selectedExporter)}function p(){e.debug("Selected poll: ",h.selectedPoll),h.action="Loading Results",h.results=h.selectedResult=null,h.exporters=h.selectedExporter=null,s.getResults(h.selectedPoll._id).then(function(e){e.forEach(function(e){e.lastActivation=_.last(e.activations)}),h.results=e,h.action=null})}function g(){e.debug("Selected result: ",h.selectedResult),h.exporters=_.flatten(_.pluck(_.where(r.registered(a.RESULT_EXPORTERS),{name:h.selectedResult.type}),"options")),h.selectedExporter=_.first(h.exporters)}e=e.getInstance("ExportResultController");var h=this;h.action=null,h.cancel=u,h["export"]=d,h.exporters=null,h.group=c,h.inflector=i,h.polls=c.polls,h.results=null,h.resultDateFormat="EEEE, dd MMMM yyyy, hh:mma",h.selectedExporter=null,h.selectedExporterChanged=m,h.selectedPoll=null,h.selectedPollChanged=p,h.selectedResult=null,h.selectedResultChanged=g}angular.module("app.myPolls").controller("ExportResultController",e),e.$inject=["$log","$filter","$injector","$mdDialog","FileSaver","inflector","plugins","PLUGIN","myPollsService","group"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a){function s(){n.$on("$stateChangeSuccess",function(e,t,o,n,l){"myPolls.collections.viewCollection"===t.name&&P.collection&&$(P.collection)}),a.getCollection(i.collectionId).then($),t("top")}function c(){l.go("myPolls.collections.viewCollection.addGroup",{collection:P.collection})}function u(){var e=P.collection;o.show(o.confirm().title("Delete Collection").content("Are you sure you would like to delete the collection "+e.name+"?").ok("Yes").cancel("Cancel")).then(function(){a.deleteCollection(e,0===e.groups.length),l.go("myPolls.upcoming")})}function d(e){o.show(o.confirm().title("Delete Group").content("Are you sure you would like to delete the group "+e.collection.name+" - "+e.name+"?").ok("Yes").cancel("Cancel")).then(function(){P.groups.splice(P.groups.indexOf(e),1);var t=P.filteredGroups.indexOf(e);t>=0&&P.filteredGroups.splice(t,1),a.deleteGroup(e)})}function m(){l.go("myPolls.collections.viewCollection.editCollection",{collection:P.collection})}function p(e){l.go("myPolls.collections.viewCollection.editGroup",{group:e})}function g(e,t){var o=t?"myPolls.collections.editPolls.addPoll":"myPolls.collections.editPolls";l.go(o,{collectionId:e.collection._id,groupId:e._id,group:e})}function h(e){l.go("myPolls.collections.viewCollection.exportResult",{group:e})}function v(e){return null!=e.upcoming&&e.upcoming<=new Date}function f(e,o){if(!(0>o||o>=P.groups.length)){var n=P.groups[e],l=P.groups[o];a.swapGroups(n,l),P.groups[e]=l,P.groups[o]=n,t("group-"+o)}}function b(e){e.upcoming=v(e)?null:new Date,a.updateGroup(e,"upcoming")}function w(t){e.debug("viewResult: ",t._id);var o=function(e){l.go("result",{resultId:e._id})};return a.getLastResult(t).then(o)["catch"](function(e){return e.code&&404===e.code?a.createResult(t).then(o):void 0})}function y(e){P.filteredGroups=a.searchGroups(P.groups,e)}function $(e){r.setTitle(n,e.name),r.setSearch(n,y),r.setMenu(n,[{label:"Edit Collection",callback:m,icon:"edit"},{label:"Delete Collection",callback:u,icon:"delete"}]),P.collection=e,P.groups=_.filter(e.groups,function(e){return!angular.isDate(e.deleted)}),y()}e=e.getInstance("ViewCollectionController");var P=this;P.addGroup=c,P.collection=null,P.deleteGroup=d,P.editGroup=p,P.editPolls=g,P.exportResults=h,P.filteredGroups=null,P.groups=null,P.isUpcoming=v,P.reorderGroup=f,P.saveTimeout=null,P.shell=r,P.toggleUpcoming=b,P.viewResult=w,s()}angular.module("app.myPolls").controller("ViewCollectionController",e),e.$inject=["$log","$anchorScroll","$mdDialog","$scope","$state","$stateParams","shell","myPollsService"]}(),function(){"use strict";function e(e,t,o){function n(){o.title="Welcome to MARS"}function l(){t.goToPreviousState()}e=e.getInstance("GettingStartedController");var i=this;i.close=l,n()}angular.module("app.myPolls").controller("GettingStartedController",e),e.$inject=["$log","$scope","shell"]}(),function(){"use strict";function e(e,t,o){function n(){o.title="Help and Support"}e=e.getInstance("HelpController");n()}angular.module("app.myPolls").controller("HelpController",e),e.$inject=["$log","$scope","shell"]}(),function(){"use strict";function e(e){e=e.getInstance("marsActionProgress");var t={restrict:"E",scope:{action:"=",mdDiameter:"@",orientation:"@"},templateUrl:"app/my-polls/shell/action-progress.directive.html",transclude:!0};return t}angular.module("app.myPolls").directive("marsActionProgress",e),e.$inject=["$log"]}(),function(){"use strict";function e(e,t,o){function n(){i.action="Saving",o.createCollection(i.collection).then(function(e){i.action=null,t.hide(e)})}function l(){t.cancel()}e=e.getInstance("AddCollectionController");var i=this;i.action=null,i.cancel=l,i.create=n,i.collection={name:"",groups:[],owners:[]}}angular.module("app.myPolls").controller("AddCollectionController",e),e.$inject=["$log","$mdDialog","myPollsService"]}(),function(){"use strict";function e(e,t,o){function n(n,l,i){n.$watch("marsFocusWhen",function(n,i){if(n){var r=t.findFocusTarget(l,"[mars-autofocus]");e.debug("Autofocus: ",r||'No target found. Add "md-autofocus" attribute to an element.'),o(function(){r&&r.focus()})}})}e=e.getInstance("marsFocusWhen");var l={link:n,restrict:"AE",scope:{marsFocusWhen:"="}};return l}angular.module("app.myPolls").directive("marsFocusWhen",e),e.$inject=["$log","$mdUtil","$timeout"]}(),function(){"use strict";function e(e,t,o){function n(n,l,i){i.$observe("marsScrollTo",function(l){n.$watch("marsScrollWhen",function(n,i){n&&(e.debug("Scroll to: "+l),o(function(){t(l)}))})})}e=e.getInstance("marsScrollTo");var l={link:n,restrict:"A",scope:{marsScrollTo:"@",marsScrollWhen:"="}};return l}angular.module("app.myPolls").directive("marsScrollTo",e),e.$inject=["$log","$anchorScroll","$timeout"]}(),function(){"use strict";function e(e,t,o,n,l,i,r,a){function s(){i.isAuthenticated().then(function(e){return"poller"!==e.group?t.go("auth.forbidden"):(h.action="Loading",void a.getCollections().then(function(e){return h.action=null,h.collections=e,0===e.length?t.go("myPolls.help.gettingStarted"):void 0}))},function(e){t.go("auth.login")})}function c(){o.show({templateUrl:"app/my-polls/shell/add-collection.html",controller:"AddCollectionController as vm"}).then(function(e){n("left").toggle(),t.go("myPolls.collections.viewCollection",{collectionId:e._id})})}function u(){t.go(h.shell.back.state,h.shell.back.stateParams)}function d(e,o){t.go(e,o),n("left").close()}function m(){t.go("auth.logout")}function p(){n("left").toggle()}function g(e){l.open(e,"","width=640, height=480")}e=e.getInstance("ShellController");var h=this;h.action=null,h.addCollection=c,h.collections=null,h.goBack=u,h.goToState=d,h.logout=m,h.openLeftMenu=p,h.openExternal=g,h.shell=r,s()}angular.module("app.myPolls").controller("ShellController",e),e.$inject=["$log","$state","$mdDialog","$mdSidenav","$window","auth","shell","myPollsService"]}(),function(){"use strict";function e(e){function t(){c.search.phrase="",n()}function o(){t(),c.search.show=!1}function n(){angular.isFunction(c.search.callback)&&c.search.callback(c.search.phrase)}function l(e,t,o){c.back.state=t,c.back.stateParams=o,e.$on("$destroy",function(){c.back.state=null,c.back.stateParams=null})}function i(e,t){c.menu.items=t,c.menu.show=!0,e.$on("$destroy",function(){c.menu.items=[],c.menu.show=!1})}function r(e,t){c.search.callback=t,e.$on("$destroy",function(){c.search.callback=!1,o()})}function a(e,t){c.title=t,e.$on("$destroy",function(){c.title=""})}function s(){c.search.show=!0}e=e.getInstance("shell");var c={back:{state:null,stateParams:null},clearSearch:t,hideSearch:o,menu:{items:[],show:!1},search:{callback:!1,phrase:"",show:!1},searchPhraseChanged:n,setBack:l,setMenu:i,setSearch:r,setTitle:a,showSearch:s,title:""};return c}angular.module("app.myPolls").factory("shell",e),e.$inject=["$log"]}(),function(){"use strict";function e(e,t,o,n,l,i,r){function a(){i.setTitle(n,"Trash"),r.getGroups().then(function(e){h.groups=_.filter(e,function(e){return _.isDate(e.deleted)||m(e)}),g(),i.setSearch(n,g)}),t("top")}function s(e){o.show(o.confirm().title("Delete Group Permanently").htmlContent("Are you sure you would like to delete the group "+e.name+"? <br/><strong>This can not be undone.</strong>").ok("Yes").cancel("Cancel")).then(function(){return e._action="Deleting",r.deleteGroup(e,!0)}).then(function(){delete e._action,p(e)})}function c(e){}function u(t){e.debug("Restore group: "+t.name),t._action="Restoring",r.restoreGroup(t).then(function(){delete t._action,p(t)})}function d(e,t){t._action="Restoring",r.restorePoll(t).then(function(){if(delete t._action,!e.deleted&&!m(e)){h.groups.splice(h.groups.indexOf(e),1);var o=h.filteredGroups.indexOf(e);o>=0&&h.filteredGroups.splice(o,1)}})}function m(e){return _.some(e.polls,function(e){return _.isDate(e.deleted)})}function p(e){h.groups.splice(h.groups.indexOf(e),1);var t=h.filteredGroups.indexOf(e);t>=0&&h.filteredGroups.splice(t,1)}function g(e){h.filteredGroups=r.searchGroups(h.groups,e)}e=e.getInstance("TrashController");var h=this;h.groups=null,h.filteredGroups=null,h.deleteGroupPermanently=s,h.restoreAllGroupsInCollection=c,h.restoreGroup=u,h.restorePoll=d,h.shell=i,a()}angular.module("app.myPolls").controller("TrashController",e),e.$inject=["$log","$anchorScroll","$mdDialog","$scope","$state","shell","myPollsService"]}(),function(){"use strict";function e(e,t,o,n,l,i){function r(){l.setTitle(o,"Upcoming Polls"),l.setSearch(o,c),i.getCollections().then(function(e){d.groups=u(e),c()}),t("top")}function a(e){var t=d.groups.splice(e,1);0!==t.length&&(t=t[0],t.upcoming=null,i.updateGroup(t,"upcoming"))}function s(t){e.debug("viewResult: ",t._id);var o=function(e){n.go("result",{resultId:e._id})};return i.getLastResult(t).then(o)["catch"](function(e){return e.code&&404===e.code?i.createResult(t).then(o):void 0})}function c(e){d.filteredGroups=i.searchGroups(d.groups,e)}function u(e){var t=(new Date,_.pluck(e,"groups"));return _.filter(_.flatten(_.zip.apply(null,t)),function(e){return _.has(e,"upcoming")&&angular.isDate(e.upcoming)&&!angular.isDate(e.deleted)})}e=e.getInstance("UpcomingController");var d=this;d.filteredGroups=null,d.groups=null,d.markGroupAsDone=a,d.viewResult=s,r()}angular.module("app.myPolls").controller("UpcomingController",e),e.$inject=["$log","$anchorScroll","$scope","$state","shell","myPollsService"]}(),function(){"use strict";angular.module("plugins.bar-chart",["app.plugins"])}(),function(){"use strict";function e(e,t){e.register(t.POLL_TYPE,"multiple-choice",!0),e.register(t.RESULT_TYPE,"multiple-choice",!0),e.register(t.RESULT_EXPORTERS,"multiple-choice",[{name:"All Responses",extension:".csv",factory:"multipleChoiceResultExportAllResponsesCsv"},{name:"Final Responses",extension:".csv",factory:"multipleChoiceResultExportFinalResponsesCsv"}])}angular.module("plugins.multiple-choice",["app.plugins","app.data"]).config(e),e.$inject=["pluginsProvider","PLUGIN"]}(),function(){"use strict";function e(e,t){e.register(t.POLL_TYPE,"word-cloud",!0),e.register(t.RESULT_TYPE,"word-cloud",!0),e.register(t.RESULT_EXPORTERS,"word-cloud",[{name:"All Responses",extension:".csv",factory:"wordCloudResultExportAllResponsesCsv"},{name:"Final Responses",extension:".csv",factory:"wordCloudResultExportFinalResponsesCsv"}])}angular.module("plugins.word-cloud",["app.plugins","app.data"]).config(e),e.$inject=["pluginsProvider","PLUGIN"]}(),function(){"use strict";function e(e,t,o){function n(n,l,i){o.loadScript("assets/bower_components/d3/d3.min.js","d3").then(function(o){var r=l[0],a=parseInt(i.barHeight)||20,s=parseInt(i.barPadding)||5,c=parseInt(i.fontSize)||20,u=parseInt(i.labelMargin)||0,d=o.select(r).append("svg").style("width","100%");n.render=function(t){if(e.debug("render"),t){var n=t.length*(a+s),l=o.scale.category20();d.attr("height",n);var i=d.selectAll("g").data(t).enter().append("g");i.append("rect").attr("width",0).attr("height",a).attr("x",u).attr("fill",function(e){return l(e.label)}),i.append("text").attr("x",u).attr("y",a/2).attr("dy","0.35em").text(function(e){return"0/0"}),i.append("text").attr("x",10).attr("y",a/2).attr("dy","0.35em").attr("font-size",c+"px").text(function(e){return e.label})}},n.update=function(t,n){if(e.debug("update"),t){var l=o.select(r).node().offsetWidth-u,i=o.scale.linear().domain([0,o.max(t,function(e){return e.value})]).range([0,l]),c=[],m=0,n=n||300;t.forEach(function(e){c.push(i(e.value)),m+=e.value});var p=d.selectAll("g").data(t).attr("transform",function(e,t){var o=0,n=t*(a+s);return"translate("+o+","+n+")"});p.select("rect").transition().duration(n).attr("width",function(e,t){return c[t]}),p.select("text").text(function(e,t){return e.value.toString()+"/"+m}).transition().duration(n).attr("x",function(e,t){var o=this.getComputedTextLength(),n=u+c[t];return o+32>c[t]?c[t]>0?n+16:n:n-16}).attr("text-anchor",function(e,t){var o=this.getComputedTextLength();return o+32>c[t]?"start":"end"})}},n.render(n.data),n.update(n.data,0);var m=function(){n.update(n.data),n.$apply()};angular.element(t).bind("resize",m),n.$on("$destroy",function(){angular.element(t).unbind("resize",m)}),n.$watch("data",function(e,t){return n.update(e)},!0)})}e=e.getInstance("barChart");var l={link:n,restrict:"EA",scope:{data:"="}};return l}angular.module("plugins.bar-chart").directive("barChart",e),e.$inject=["$log","$window","plugins"]}(),function(){"use strict";function e(e,t,o){function n(){angular.isArray(c.poll.data.choices)||(c.poll.data.choices=[]),(c.poll.data.choices.length>0&&!c.poll.data.choices[c.poll.data.choices.length-1].blank||0===c.poll.data.choices.length)&&a(),o.beforeSave(t,c.poll,function(e){angular.isArray(e.data.choices)&&(e.data.choices=_.map(_.filter(e.data.choices,function(e){return!e.blank}),function(e){return _.omit(e,["$$hashKey","blank"])}))})}function l(e,t){(t.text||angular.isDefined(t.correct))&&(t.blank=!1,o.updatePoll(c.poll)),e===c.poll.data.choices.length-1&&t.text&&a()}function i(e){e.name=e.data.question,o.updatePoll(e)}function r(e){c.poll.data.choices.splice(e,1),s(),o.updatePoll(c.poll,!0)}function a(){var e=c.poll.data.choices.length;c.poll.data.choices.push({label:String.fromCharCode(65+e),type:"multiple-choice-text-choice",text:"",correct:!1,blank:!0})}function s(){c.poll.data.choices.forEach(function(e,t){e.label=String.fromCharCode(65+t)})}e=e.getInstance("MultipleChoicePollEditController");var c=this;c.choiceValueChanged=l,c.poll=t.poll,c.questionChanged=i,c.removeChoice=r,c.newChoice=a,c.relabelChoices=s,n()}angular.module("plugins.multiple-choice").controller("MultipleChoicePollEditController",e),e.$inject=["$log","$scope","pollPluginService"]}(),function(){"use strict";function e(e,t,o){function n(n){n!==l.selectedChoice&&(l.selectedChoice=n,o.submitResponse(t.result._id,n.label),e.info("Submitted response: ",n.label))}e=e.getInstance("MultipleChoicePollViewController");var l=this;l.selectedChoice=null,l.submitResponse=n}angular.module("plugins.multiple-choice").controller("MultipleChoicePollViewController",e),e.$inject=["$log","$scope","pollPluginService"]}(),function(){"use strict";function e(e,t,o,n){return e=e.getInstance("multipleChoiceResultExportAllResponsesCsv"),function(l){e.debug("csv = ",n);var i=n();return i.addRow([l.poll.data.question]).newRow(),l.poll.data.choices.forEach(function(e){i.addRow([e.label,e.text])}),i.newRow(),i.addRow(["Username","Timestamp","Response"]),l.responses.forEach(function(e){i.addRow([e.user.username,t("date")(e.time,"yyyy-MM-dd HH:mm:ss"),e.data])}),o.resolve(i.blob())}}angular.module("plugins.multiple-choice").factory("multipleChoiceResultExportAllResponsesCsv",e),e.$inject=["$log","$filter","$q","csvWriter"]}(),function(){"use strict";function e(e,t,o,n){function l(e){return _.groupBy(e,function(e){return e.user.username})}return e=e.getInstance("multipleChoiceResultExportFinalResponsesCsv"),function(e){var i=n();return i.addRow([e.poll.data.question]).newRow(),e.poll.data.choices.forEach(function(e){i.addRow([e.label,e.text])}),i.newRow(),i.addRow(["Username","Timestamp","Response","Number of Tries"]),_.each(l(e.responses),function(e,o){var n=_.last(e);i.addRow([o,t("date")(n.time,"yyyy-MM-dd HH:mm:ss"),n.data,e.length])}),o.resolve(i.blob())}}angular.module("plugins.multiple-choice").factory("multipleChoiceResultExportFinalResponsesCsv",e),e.$inject=["$log","$filter","$q","csvWriter"]}(),function(){"use strict";function e(e,t,o){function n(){var e=t.poll,n=t.result;angular.isObject(n.data)||(n.data={}),n.data.hasOwnProperty("multiple-choice")||(n.data["multiple-choice"]=_.map(e.data.choices,function(e){return{label:e.label,text:e.text,value:0}})),n.data["multiple-choice"].forEach(function(e){i.choices[e.label]=e}),i.responsesByUser=_.groupBy(n.responses,"user"),_.each(i.responsesByUser,function(e){i.choices[_.last(e).data].value++}),o.onResponseReceived(t,n._id,l)}function l(e){if(_.has(i.responsesByUser,e.user)){var t=_.last(i.responsesByUser[e.user]);i.choices[t.data].value--}else i.responsesByUser[e.user]=[];i.responsesByUser[e.user].push(e),_.has(i.choices,e.data)&&i.choices[e.data].value++}e=e.getInstance("MultipleChoiceResultViewController");var i=this;i.choices={},i.responsesByUser=null,n()}angular.module("plugins.multiple-choice").controller("MultipleChoiceResultViewController",e),e.$inject=["$log","$scope","resultPluginService"]}(),function(){"use strict";function e(e,t,o,n,l){function i(e,t,o){l.loadScript("assets/bower_components/d3/d3.min.js","d3").then(function(){return l.loadScript("assets/bower_components/d3-cloud/build/d3.layout.cloud.js","cloud")}).then(function(){r(e,t[0])})}function r(t,o){function l(t,o){e.debug("render");var n=d.selectAll("text").data(t,function(e){return e.text});n.enter().append("text").attr("font-size",1).attr("text-anchor","middle").style("fill",function(e,t){return r(t)}).style("font-family","Impact").text(function(e){return e.text}),n.transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")rotate("+e.rotate+")"}).style("font-size",function(e){return e.size+"px"}),n.exit().transition().duration(200).attr("font-size",1).style("fill-opacity",1e-6).remove(),d.attr("transform","translate("+s/2+","+a/2+")")}function i(t){if(e.debug("update"),u.style("width","100%"),s=parseInt(u.style("width"),10),a=2*s/5,!isNaN(s)&&!isNaN(a)){u.attr("width",s).attr("height",a);var o=_.pluck(t,"value"),n=_.min(o),l=_.max(o),i=_.reduce(_.unique(o),function(e,t){return e+t}),r=Math.max(100-10*o.length,25),c=Math.min(r+10*i,100),d=d3.scale.log().range([r,c]);t.length&&d.domain([n,l]),m.stop().size([s,a]).fontSize(function(e){return d(e.value)}).words(t).start()}}var r=d3.scale.category20(),a=Number.NaN,s=Number.NaN,c=[],u=d3.select(o).append("svg"),d=u.append("g"),m=d3.layout.cloud().padding(5).rotate(0).font("Impact").text(function(e){return e.text}).on("end",l),p=_.throttle(i,2e3),g=_.debounce(function(){i(c),t.$apply()},500);angular.element(n).bind("resize",g),t.$on("$destroy",function(){angular.element(n).unbind("resize",g)}),t.$watch("words",function(e,o){angular.isArray(e)&&(angular.copy(t.words,c),p(c))},!0)}e=e.getInstance("wordCloud");var a={link:i,restrict:"EA",scope:{words:"="}};return a}angular.module("plugins.word-cloud").directive("wordCloud",e),e.$inject=["$log","$compile","$q","$window","plugins"]}(),function(){"use strict";function e(e,t,o){function n(){}function l(e){e.name=e.data.question,o.updatePoll(e)}e=e.getInstance("WordCloudPollEditController");var i=this;i.poll=t.poll,i.questionChanged=l,n()}angular.module("plugins.multiple-choice").controller("WordCloudPollEditController",e),e.$inject=["$log","$scope","pollPluginService"]}(),function(){"use strict";function e(e,t,o){function n(){i.response="",i.hasSubmitted=!1}function l(n){i.hasSubmitted=!0,o.submitResponse(t.result._id,n),e.info("Submitted response: ",n)}e=e.getInstance("WordCloudPollViewController");var i=this;i.clearResponse=n,i.hasSubmitted=!1,i.response="",i.submitResponse=l}angular.module("plugins.word-cloud").controller("WordCloudPollViewController",e),e.$inject=["$log","$scope","pollPluginService"]}(),function(){"use strict";function e(e,t,o,n){return e=e.getInstance("wordCloudResultExportAllResponsesCsv"),function(l){e.debug("csv = ",n);var i=n();return i.addRow([l.poll.data.question]).newRow(),i.addRow(["Username","Timestamp","Response"]),l.responses.forEach(function(e){i.addRow([e.user.username,t("date")(e.time,"yyyy-MM-dd HH:mm:ss"),e.data])}),o.resolve(i.blob())}}angular.module("plugins.word-cloud").factory("wordCloudResultExportAllResponsesCsv",e),e.$inject=["$log","$filter","$q","csvWriter"]}(),function(){"use strict";function e(e,t,o,n){function l(e){return _.groupBy(e,function(e){return e.user.username})}return e=e.getInstance("wordCloudResultExportFinalResponsesCsv"),function(e){var i=n();return i.addRow([e.poll.data.question]).newRow(),i.addRow(["Username","Timestamp","Response","Number of Tries"]),_.each(l(e.responses),function(e,o){var n=_.last(e);i.addRow([o,t("date")(n.time,"yyyy-MM-dd HH:mm:ss"),n.data,e.length])}),o.resolve(i.blob())}}angular.module("plugins.word-cloud").factory("wordCloudResultExportFinalResponsesCsv",e),e.$inject=["$log","$filter","$q","csvWriter"]}(),function(){"use strict";function e(e,t,o){function n(){var e=(r.poll=t.poll,r.result=t.result);angular.isObject(e.data)||(e.data={}),e.data.hasOwnProperty("word-cloud")||(e.data["word-cloud"]=[]),_.each(e.responses,function(e){i(e.data)}),o.onResponseReceived(t,e._id,l)}function l(t){e.debug("response = ",t),i(t.data)}function i(e){angular.isObject(r.words[e])?r.words[e].value++:(r.words[e]={text:e,value:1},r.result.data["word-cloud"]=_.values(r.words)),r.wordsUpdated=!0}e=e.getInstance("WordCloudResultViewController");var r=this;r.poll=null,r.responsesByUser=null,r.result=null,r.words={},r.wordsUpdated=!1,n()}angular.module("plugins.word-cloud").controller("WordCloudResultViewController",e),e.$inject=["$log","$scope","resultPluginService"]}();